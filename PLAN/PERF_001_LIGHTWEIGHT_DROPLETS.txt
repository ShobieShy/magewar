================================================================================
PERFORMANCE CONSIDERATION #1: LIGHTWEIGHT DROPLETS
================================================================================

Current State:
- LootPickup uses Area3D with collision detection
- Creates MeshInstance3D and OmniLight3D per item
- Each pickup is a full scene with animation
- No pooling or optimization for multiple simultaneous drops

Challenge:
- Dungeons with many enemies can spawn 50+ items at once
- Each item has collision, physics, and visual rendering overhead
- Despawn system relies on timeout (no optimization)

================================================================================
DETAILED TODO LIST
================================================================================

[ ] Phase 1: PROFILING & MEASUREMENT
    [ ] Profile frame time during boss fights with multiple drops
    [ ] Measure memory usage with 100+ pickups on ground
    [ ] Profile collision detection with dense loot groups
    [ ] Identify frame drops and performance bottlenecks
    [ ] Document baseline metrics before optimization
    [ ] Create test scene with 200 simultaneous pickups
    [ ] Measure physics simulation cost
    [ ] Measure rendering cost per pickup

[ ] Phase 2: OPTIMIZATION ANALYSIS
    [ ] Evaluate object pooling approach
        [ ] Design object pool manager
        [ ] Calculate ideal pool size (20-50 items?)
        [ ] Plan pool growth/shrinkage strategy
    [ ] Evaluate LOD (Level of Detail) system
        [ ] Close range: Full mesh + light + collision
        [ ] Medium range: Mesh only, no light
        [ ] Far range: Simplified mesh or billboard
    [ ] Evaluate spatial partitioning
        [ ] Quad-tree for fast lookups
        [ ] Grid-based region management
    [ ] Consider batch rendering
        [ ] Group pickups by rarity
        [ ] Use shared materials
        [ ] Instanced rendering possibility

[ ] Phase 3: IMPLEMENTATION PLANNING
    [ ] Choose optimization strategy (pool vs LOD vs batch)
        [ ] Pros/cons analysis for each
        [ ] Performance estimation
        [ ] Implementation complexity
        [ ] Maintainability impact
    [ ] If pooling:
        [ ] Design LootPickupPool class
        [ ] Queue management system
        [ ] Reusable instance setup/cleanup
        [ ] Reset state on reuse
        [ ] Despawn back to pool instead of queue_free()
    [ ] If LOD:
        [ ] Design distance-based switching
        [ ] Camera distance calculation
        [ ] Transition smoothing
        [ ] Configuration per rarity (higher = always visible?)
    [ ] If batch rendering:
        [ ] Design shared material system
        [ ] Rarity color handling
        [ ] Update strategy for animations

[ ] Phase 4: COLLISION OPTIMIZATION
    [ ] Reduce collision layer usage
        [ ] Consolidate collision groups
        [ ] Use Area3D or physics bodies more efficiently
    [ ] Implement spatial grid for pickup detection
        [ ] Avoid brute force distance checks
        [ ] Efficient player proximity queries
    [ ] Consider simplified collision shapes
        [ ] Spheres instead of boxes?
        [ ] Reduced collision group count?

[ ] Phase 5: ANIMATION OPTIMIZATION
    [ ] Replace bob animation with cheaper method
        [ ] Pre-baked animation texture?
        [ ] Vertex shader animation?
        [ ] Simple Y-offset calculation vs tween?
    [ ] Benchmark current animation cost
    [ ] Consider disabling animation for far pickups (LOD)

[ ] Phase 6: MEMORY OPTIMIZATION
    [ ] Track memory allocation per pickup
    [ ] Identify memory leaks in despawn process
    [ ] Optimize scene instantiation
    [ ] Consider static/shared resources
    [ ] Memory pooling for frequently created objects

[ ] Phase 7: IMPLEMENTATION
    [ ] Implement chosen optimization
    [ ] Add performance metrics logging
    [ ] Create visual debug display (pickup count, frame time)
    [ ] Test with stress scenarios
        [ ] 50 items at once
        [ ] 100 items at once
        [ ] 200 items at once
    [ ] Measure improvement vs baseline
    [ ] Document results

[ ] Phase 8: VALIDATION & TUNING
    [ ] Ensure no gameplay impact
    [ ] Verify pickup mechanics still work
    [ ] Test in actual dungeons
    [ ] Adjust pool size/LOD distances as needed
    [ ] Profile on target hardware (console/lower-end PC)

[ ] Phase 9: FUTURE MONITORING
    [ ] Set up performance alerts
    [ ] Regular profiling during development
    [ ] Monitor for regression
    [ ] Track performance metrics over time

================================================================================
QUESTIONS FOR PLANNING
================================================================================

Q: What's the typical max loot on ground at once?
   - Current dungeons might have 10-20 items
   - Boss battles could spike to 50+
   - Need data on actual gameplay patterns

Q: Should rare items remain visible longer/further?
   - Gameplay consideration: player needs to see loot
   - Suggestion: higher rarity = larger collision radius, further LOD distance

Q: Is animation important for feel?
   - Bob animation currently: sin(frame * 0.02) * 0.1
   - Could be replaced with simpler calculation
   - What visual effect matters most?

Q: Performance target?
   - 60 FPS maintained?
   - 30 FPS acceptable in extreme situations?
   - Target platform (PC, Switch, PS5)?

================================================================================
IMPLEMENTATION PREFERENCES
================================================================================

RECOMMENDED APPROACH:
1. Start with Object Pooling (simpler, high impact)
2. Add LOD if pooling not enough
3. Only batch if heavy CPU required

ESTIMATED EFFORT:
- Pooling: 4-6 hours
- LOD: 6-8 hours
- Batch rendering: 8-12 hours

ESTIMATED IMPACT:
- Pooling: 30-40% improvement
- LOD: 20-30% additional improvement
- Batch rendering: 10-20% additional improvement

================================================================================
DEPENDENCIES
================================================================================

Required:
- Performance profiling tools (Godot debugger)
- Test scene with many enemies
- Stress test methodology

Related Systems:
- LootSystem (spawning)
- Constants (configuration)
- Enemy spawning system

================================================================================
RISK ASSESSMENT
================================================================================

Risks:
- Pooling adds complexity (state management)
- LOD might miss pickups in player view
- Batch rendering incompatible with dynamic rarity colors?

Mitigation:
- Comprehensive testing with edge cases
- Fallback to simpler method if issues
- Performance tests before/after changes

================================================================================
SUCCESS CRITERIA
================================================================================

[ ] 50+ items on ground without frame drops
[ ] Memory usage stable (no leaks)
[ ] Pickup mechanics unchanged
[ ] Collision detection responsive
[ ] Works on all target platforms
[ ] No visual quality regression

================================================================================
